# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –æ–ø–ª–∞—Ç–æ–π üí≥

## –ü–æ—á–µ–º—É –æ–ø–ª–∞—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞?

### 1. –ü—Ä–∏—á–∏–Ω—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞ –∫–∞—Ä—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É

#### –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–µ–¥–µ–Ω –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ CVV/CVC –∫–æ–¥
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã

#### –ò—Å—Ç–µ–∫—à–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞—Ä—Ç—ã
- **–ü—Ä–∏—á–∏–Ω–∞:** –ö–∞—Ä—Ç–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É

#### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã –±–∞–Ω–∫–æ–º
- **–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–Ω–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∫–∞—Ä—Ç—É –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º (–ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –≤ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–µ, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∏ —Ç.–¥.)
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–≤–æ–π –±–∞–Ω–∫

### 2. –ü—Ä–∏—á–∏–Ω—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –±–∞–Ω–∫–∞

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–∞–Ω–∫–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–Ω–∫ —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ª–∏–º–∏—Ç—ã –Ω–∞ —Å—É–º–º—É –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–≤—è–∑–∞—Ç—å—Å—è —Å –±–∞–Ω–∫–æ–º –¥–ª—è —Å–Ω—è—Ç–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

#### –ë–∞–Ω–∫-—ç–º–∏—Ç–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **–ü—Ä–∏—á–∏–Ω–∞:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–Ω–∫–æ–º-—ç–º–∏—Ç–µ–Ω—Ç–æ–º –∫–∞—Ä—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ

#### –û—à–∏–±–∫–∞ 3D Secure
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π 3D Secure
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –æ–ø–ª–∞—Ç—ã

### 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏—á–∏–Ω—ã

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞

#### –ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –Ω–∞ –æ–ø–ª–∞—Ç—É
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª –æ–ø–ª–∞—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ YooKassa
- **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ –≤ YooKassa
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa

## –ö–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É?

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞

–ò—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å —Ç–µ–≥–∞–º–∏:
- `payment_canceled` - –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
- `payment_error` - –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
- `yookassa` - –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å YooKassa

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ YooKassa

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç YooKassa
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü–ª–∞—Ç–µ–∂–∏"
3. –ù–∞–π–¥–∏—Ç–µ –ø–ª–∞—Ç–µ–∂ –ø–æ ID (–∏–∑ –ª–æ–≥–æ–≤ –±–æ—Ç–∞)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook

Webhook –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç YooKassa.

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
YOOKASSA_WEBHOOK_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/yookassa
```

**–í–∞–∂–Ω–æ:**
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–Ω–µ localhost)
- URL –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞ YooKassa

**–ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å webhook –≤ YooKassa:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç YooKassa
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –î–æ–±–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ webhook
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è: `payment.succeeded` –∏ `payment.canceled`

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
YOOKASSA_SHOP_ID=–≤–∞—à_shop_id
YOOKASSA_SECRET_KEY=–≤–∞—à_secret_key
YOOKASSA_WEBHOOK_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/yookassa
PAYMENT_SUCCESS_URL=https://t.me/–≤–∞—à_–±–æ—Ç?start=payment_success
PAYMENT_RETURN_URL=https://t.me/–≤–∞—à_–±–æ—Ç?start=payment_cancel
TELEGRAM_BOT_USERNAME=–≤–∞—à_–±–æ—Ç
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É webhook endpoint:

```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/yookassa \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏).

## –£–ª—É—á—à–µ–Ω–∏—è –≤ –∫–æ–¥–µ

–ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–æ—Ç —Ç–µ–ø–µ—Ä—å:

1. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã** –∏–∑ webhook YooKassa
2. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –æ –ø—Ä–∏—á–∏–Ω–µ –æ—Ç–º–µ–Ω—ã
3. **–õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ–± –æ—Ç–º–µ–Ω–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞** –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç

## –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–µ–π

–°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ YooKassa, –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **insufficient_funds** (30-40%) - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
2. **call_issuer** (20-25%) - –ë–∞–Ω–∫ –æ—Ç–∫–ª–æ–Ω–∏–ª –ø–ª–∞—Ç–µ–∂
3. **expired_on_confirmation** (10-15%) - –ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –Ω–∞ –æ–ø–ª–∞—Ç—É
4. **invalid_csc** (5-10%) - –ù–µ–≤–µ—Ä–Ω—ã–π CVV/CVC –∫–æ–¥
5. **3d_secure_failed** (5-10%) - –û—à–∏–±–∫–∞ 3D Secure

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è?

1. **–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–≤—è–∑–∞—Ç—å—Å—è —Å –±–∞–Ω–∫–æ–º** - —á–∞—Å—Ç–æ –±–∞–Ω–∫ –º–æ–∂–µ—Ç –¥–∞—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ YooKassa** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞** - —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
4. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YooKassa** - –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YooKassa API](https://yookassa.ru/developers/api)
- [–ü—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–µ–π](https://yookassa.ru/developers/payment-acceptance/getting-started/quick-start)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook](https://yookassa.ru/developers/using-api/webhooks)

