# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–ª–∞—Ç–µ–∂–µ–π:

```
ValueError: too many values to unpack (expected 2)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- PostgreSQL –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 3 –∑–Ω–∞—á–µ–Ω–∏—è: `(user_id, yookassa_payment_id, created_at)`
- SQLite –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 2 –∑–Ω–∞—á–µ–Ω–∏—è: `(user_id, yookassa_payment_id)`
- –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ 2 –∑–Ω–∞—á–µ–Ω–∏—è: `for user_id, yookassa_payment_id in pending_payments:`

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `check_pending_payments_periodically`:

**–ë—ã–ª–æ:**
```python
for user_id, yookassa_payment_id in pending_payments:
```

**–°—Ç–∞–ª–æ:**
```python
for payment_row in pending_payments:
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫
    # PostgreSQL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (user_id, yookassa_payment_id, created_at)
    # SQLite –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (user_id, yookassa_payment_id)
    user_id = payment_row[0]
    yookassa_payment_id = payment_row[1]
```

–¢–µ–ø–µ—Ä—å –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–µ–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.

## üìç –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

–§–∞–π–ª: `bot.py`
–§—É–Ω–∫—Ü–∏—è: `check_pending_payments_periodically`
–°—Ç—Ä–æ–∫–∏: 4890-4895

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏ PostgreSQL, –∏ SQLite
- ‚úÖ –ü–ª–∞—Ç–µ–∂–∏ —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã

## üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –æ—à–∏–±–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É** - –ø–ª–∞—Ç–µ–∂–∏ –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

