# Исправление автоматической генерации без команды /start

## Проблема

Генерация натальной карты не начиналась автоматически после успешной оплаты через webhook YooKassa. Пользователю нужно было вручную использовать команду `/start` после возврата в бота.

## Причина

Функция `process_payment_async`, которая вызывается при получении webhook `payment.succeeded`, вызывала `check_and_process_pending_payment`. Эта функция искала "необработанные" платежи (pending или succeeded без события payment_success), но при обработке webhook событие `payment_success` уже записывалось, поэтому платеж не находился как "необработанный" и генерация не запускалась.

## Решение

Переписана функция `process_payment_async` для прямого запуска генерации после успешной оплаты:

1. **Прямой запуск генерации** - функция больше не полагается на `check_and_process_pending_payment`, а напрямую запускает `handle_natal_chart_request_from_payment`
2. **Проверка профиля** - перед запуском генерации проверяется, заполнен ли профиль пользователя
3. **Автоматическая генерация** - если профиль заполнен, генерация запускается автоматически без необходимости использовать команду `/start`
4. **Уведомление пользователя** - если профиль не заполнен, пользователю отправляется сообщение с кнопкой для заполнения профиля

### Изменения:

- Функция `process_payment_async` теперь напрямую вызывает `handle_natal_chart_request_from_payment` вместо `check_and_process_pending_payment`
- Добавлена проверка заполненности профиля перед запуском генерации
- Генерация запускается автоматически при получении webhook `payment.succeeded`, если профиль заполнен

### Преимущества:

- Генерация начинается автоматически сразу после успешной оплаты
- Не требуется использование команды `/start` после оплаты
- Более быстрая реакция на успешную оплату
- Профиль проверяется перед запуском генерации

## Измененные места в коде

- Строки 5081-5098: Полностью переписана функция `process_payment_async` для прямого запуска генерации

## Результат

Теперь после успешной оплаты генерация натальной карты запускается автоматически через webhook YooKassa, без необходимости использовать команду `/start`. Пользователю достаточно просто оплатить, и генерация начнется автоматически (если профиль заполнен).

