# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

### 1. –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –ù–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã (81 —Ñ—É–Ω–∫—Ü–∏—è, 1 –∫–ª–∞—Å—Å)
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
  - `start` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
  - `button_handler` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
  - `handle_natal_chart_request` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
  - `generate_natal_chart_background` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã
  - `process_payment_async` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
  - `handle_natal_chart_request_from_payment` - –∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

### 3. Webhook handlers
- ‚úÖ `telegram_webhook` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram
- ‚úÖ `yookassa_webhook` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç YooKassa
- ‚úÖ `process_update` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ `application_ready_event` - —Å–æ–±—ã—Ç–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Application
- ‚úÖ `process_payment_async` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ `handle_natal_chart_request_from_payment` - –∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ event loop
- ‚úÖ –ù–∞–π–¥–µ–Ω—ã –≤—ã–∑–æ–≤—ã `loop.close()`
- ‚úÖ `loop` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `None`
- ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ `loop is not None` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º

### 5. –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ `telegram_webhook` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `application_instance.process_update`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö
- ‚úÖ `process_payment_async` –≤—ã–∑—ã–≤–∞–µ—Ç `handle_natal_chart_request_from_payment`
- ‚úÖ `handle_natal_chart_request_from_payment` –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- ‚úÖ `application_ready_event` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (set() –∏ wait())

### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å event loop
- ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `loop is not None`
- ‚úÖ `loop` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `None`

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **generate_natal_chart_background –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 6 —Ä–∞–∑** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
   - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ webhook
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram Payments
   - –ò –¥—Ä—É–≥–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üìù –í—ã–≤–æ–¥—ã

–ö–æ–¥ –ø—Ä–æ—à–µ–ª –≤—Å–µ —Ç–µ—Å—Ç—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –ª–æ–≥–∏–∫–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞:

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - —á–µ—Ä–µ–∑ `application_instance.process_update()` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - —á–µ—Ä–µ–∑ `process_payment_async` ‚Üí `handle_natal_chart_request_from_payment` ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
3. **Event loop –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ** - –≤—Å–µ loop –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ finally –±–ª–æ–∫–∞—Ö
4. **Application –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** - —á–µ—Ä–µ–∑ `application_ready_event`

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É

–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã, webhook URLs)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

