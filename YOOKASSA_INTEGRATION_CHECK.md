# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ÆKassa API v3

## –°–≤–µ—Ä–∫–∞ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π: https://yookassa.ru/developers/payment-acceptance/getting-started/quick-start

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

#### 1. URL –∏ –º–µ—Ç–æ–¥
- ‚úÖ URL: `https://api.yookassa.ru/v3/payments`
- ‚úÖ –ú–µ—Ç–æ–¥: `POST`

#### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ Basic Auth: `shop_id:secret_key` ‚Üí Base64
- ‚úÖ –§–æ—Ä–º–∞—Ç: `Authorization: Basic {base64_string}`

#### 3. –ó–∞–≥–æ–ª–æ–≤–∫–∏ (Headers)
- ‚úÖ `Content-Type: application/json`
- ‚úÖ `Authorization: Basic {base64}`
- ‚úÖ `Idempotence-Key: {unique_key}` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

#### 4. –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (Request Body)

##### amount (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ `value`: —Å—Ç—Ä–æ–∫–∞ —Å –¥–≤—É–º—è –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π (—Ñ–æ—Ä–º–∞—Ç: "499.00")
- ‚úÖ `currency`: "RUB"

##### confirmation (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ `type`: "redirect"
- ‚úÖ `return_url`: URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã/–æ—Ç–º–µ–Ω—ã

##### capture (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ `capture: true` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

##### description (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

##### metadata (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ)
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (user_id, payment_type)

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `response.status_code == 200`
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `confirmation.confirmation_url`
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `id` –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–ª–∞—Ç–µ–∂–µ –≤ –ë–î

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ 401 Unauthorized - –Ω–µ–≤–µ—Ä–Ω—ã–µ credentials
- ‚úÖ 400 Bad Request - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ ConnectTimeout - –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- ‚úÖ ReadTimeout - –ø—Ä–æ–±–ª–µ–º—ã —Å —á—Ç–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞
- ‚úÖ ConnectionError - –æ—à–∏–±–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ RequestException - –æ–±—â–∏–µ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–§–æ—Ä–º–∞—Ç value –≤ amount**
   - –¢–µ–∫—É—â–∏–π: `f"{amount_rub:.2f}"` ‚Üí "499.00" ‚úÖ
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ: —Å—Ç—Ä–æ–∫–∞ —Å –¥–≤—É–º—è –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

2. **return_url vs success_url**
   - –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è `redirect` —Ç–∏–ø–∞ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ `return_url`
   - `success_url` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ confirmation, –Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ

3. **Idempotence-Key**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ ‚úÖ
   - –§–æ—Ä–º–∞—Ç: `natal_chart_{user_id}_{uuid}` ‚úÖ

4. **Timeout**
   - Connect timeout: 10 —Å–µ–∫—É–Ω–¥ ‚úÖ
   - Read timeout: 60 —Å–µ–∫—É–Ω–¥ ‚úÖ

### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é URL**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `return_url` —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º URL
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `https://`

2. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API

3. **–î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º**
   - –ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (timeout, 5xx) –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç amount**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ value –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ —Å –¥–≤—É–º—è –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ

